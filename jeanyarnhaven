<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jeans Yarn Haven | Premium Crochet Supplies & Hooks</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400..900;1,400..900&family=Plus+Jakarta+Sans:wght@200..800&display=swap');

        :root {
            --nude-light: #F9F7F2;
            --nude-base: #E8DED1;
            --nude-dark: #C4A484;
            --nude-deep: #8E735B;
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--nude-light);
            color: #333;
        }

        h1, h2, h3, .serif {
            font-family: 'Playfair Display', serif;
        }

        .scroll-hide::-webkit-scrollbar {
            display: none;
        }

        .sticky-header {
            position: sticky;
            top: 0;
            z-index: 50;
            backdrop-filter: blur(8px);
            background-color: rgba(249, 247, 242, 0.9);
        }

        /* Overlays */
        #search-overlay, #mobile-menu {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(249, 247, 242, 0.98);
            z-index: 200;
        }

        .animate-fade-in {
            animation: fadeIn 0.4s ease-out forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .badge-best-seller {
            background: #8E735B;
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 8px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
    </style>
</head>
<body>

    <!-- Top Bar -->
    <div class="bg-[#8E735B] text-white text-[10px] py-2 text-center tracking-widest uppercase font-medium">
        Free delivery within Nairobi on orders above <span data-price-kes="5000">KSh 5,000</span>
    </div>

    <!-- Header -->
    <header class="sticky-header border-b border-stone-200">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center gap-4">
                <button onclick="toggleMobileMenu()" class="md:hidden text-2xl hover:text-[#C4A484] transition">
                    <i class="fa-solid fa-bars-staggered"></i>
                </button>
                <nav class="hidden md:flex gap-6 text-sm font-medium uppercase tracking-tight">
                    <a href="#" class="hover:text-[#C4A484] transition">Home</a>
                    <a href="#shop" class="hover:text-[#C4A484] transition font-bold">Shop</a>
                    <a href="#commissions" class="hover:text-[#C4A484] transition">Custom Stitches</a>
                </nav>
            </div>

            <div class="text-center">
                <h1 class="text-xl md:text-3xl font-bold text-[#8E735B] tracking-tighter cursor-pointer" onclick="window.location.reload()">JEANS YARN HAVEN</h1>
                <p class="hidden sm:block text-[8px] md:text-[10px] tracking-[0.3em] uppercase opacity-70">Crochet Excellence Since 2024</p>
            </div>

            <div class="flex items-center gap-3 md:gap-5">
                <!-- Currency Selector (Desktop) -->
                <div class="hidden md:block relative group">
                    <select id="currency-desktop" onchange="updateCurrency(this.value)" class="appearance-none bg-transparent text-[11px] font-bold text-stone-600 border border-stone-300 rounded-full px-3 py-1 pr-6 cursor-pointer hover:border-[#C4A484] focus:outline-none focus:border-[#8E735B] transition">
                        <option value="KES">KES</option>
                        <option value="USD">USD</option>
                        <option value="GBP">GBP</option>
                        <option value="EUR">EUR</option>
                    </select>
                    <i class="fa-solid fa-chevron-down absolute right-2.5 top-1/2 -translate-y-1/2 text-[8px] text-stone-400 pointer-events-none"></i>
                </div>

                <button onclick="toggleSearch()" class="hover:text-[#C4A484]"><i class="fa-solid fa-magnifying-glass text-xl"></i></button>
                <div class="relative cursor-pointer" onclick="toggleCart()">
                    <i class="fa-solid fa-bag-shopping text-xl"></i>
                    <span id="cart-count" class="absolute -top-2 -right-2 bg-[#C4A484] text-white text-[10px] w-4 h-4 rounded-full flex items-center justify-center">0</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Mobile Menu Overlay -->
    <div id="mobile-menu" class="flex flex-col p-8 overflow-y-auto">
        <div class="flex justify-between items-center mb-8">
            <span class="text-xs uppercase tracking-widest font-bold opacity-30">Menu</span>
            <button onclick="toggleMobileMenu()" class="text-4xl font-light hover:text-[#C4A484]">&times;</button>
        </div>
        
        <!-- Mobile Currency Selector -->
        <div class="mb-8 p-4 bg-stone-100 rounded-xl">
            <label class="text-[10px] uppercase tracking-widest font-bold text-stone-500 block mb-2">Select Currency</label>
            <div class="flex gap-2">
                <button onclick="updateCurrency('KES')" class="currency-btn-mobile flex-1 py-2 text-xs font-bold rounded-lg border border-stone-200 bg-white" data-curr="KES">KES</button>
                <button onclick="updateCurrency('USD')" class="currency-btn-mobile flex-1 py-2 text-xs font-bold rounded-lg border border-stone-200 bg-white" data-curr="USD">USD</button>
                <button onclick="updateCurrency('GBP')" class="currency-btn-mobile flex-1 py-2 text-xs font-bold rounded-lg border border-stone-200 bg-white" data-curr="GBP">GBP</button>
                <button onclick="updateCurrency('EUR')" class="currency-btn-mobile flex-1 py-2 text-xs font-bold rounded-lg border border-stone-200 bg-white" data-curr="EUR">EUR</button>
            </div>
        </div>

        <nav class="flex flex-col gap-8 text-4xl italic">
            <a href="#" onclick="toggleMobileMenu()" class="hover:text-[#C4A484] transition">Home</a>
            <a href="#shop" onclick="toggleMobileMenu()" class="hover:text-[#C4A484] transition">Shop Supplies</a>
            <a href="#commissions" onclick="toggleMobileMenu()" class="hover:text-[#C4A484] transition">Custom Orders</a>
            <a href="https://www.instagram.com/_jeansyarnhaven" target="_blank" class="hover:text-[#C4A484] transition">Instagram</a>
        </nav>
        <div class="mt-auto pt-8 border-t border-stone-200">
            <p class="text-xs uppercase tracking-widest text-stone-400 mb-4">Contact us</p>
            <div class="flex items-start gap-3 mb-4 text-stone-600">
                <i class="fa-solid fa-location-dot mt-1"></i>
                <span class="text-sm font-medium">Kiambu Town, Nairobi, Kenya</span>
            </div>
            <a href="tel:+254759225892" class="block text-xl mb-2 font-medium">+254 759 225 892</a>
            <a href="mailto:jeanyarnshaven@gmail.com" class="block text-stone-500">jeanyarnshaven@gmail.com</a>
        </div>
    </div>

    <!-- Search Overlay -->
    <div id="search-overlay" class="flex flex-col items-center justify-center p-6">
        <button onclick="toggleSearch()" class="absolute top-8 right-8 text-4xl font-light hover:text-[#C4A484] transition">&times;</button>
        <div class="w-full max-w-2xl text-center">
            <h3 class="text-2xl md:text-3xl italic mb-8">Looking for specific crochet tools?</h3>
            <div class="relative border-b-2 border-stone-800 py-4">
                <input type="text" id="search-input" oninput="handleSearch()" placeholder="Search yarn, hooks..." class="w-full bg-transparent text-xl md:text-2xl outline-none placeholder:text-stone-300">
            </div>
            <div id="search-results" class="mt-8 grid grid-cols-2 md:grid-cols-3 gap-4 text-left overflow-y-auto max-h-[50vh] p-2"></div>
        </div>
    </div>

    <!-- Hero Section -->
    <section class="relative h-[50vh] md:h-[60vh] flex items-center justify-center overflow-hidden bg-[#E8DED1]">
        <div class="absolute inset-0 opacity-40">
            <svg width="100%" height="100%" viewBox="0 0 100 100" preserveAspectRatio="none">
                <path d="M0 100 C 20 0 50 0 100 100 Z" fill="#F9F7F2"></path>
            </svg>
        </div>
        <div class="relative z-10 text-center px-4">
            <h2 class="text-3xl md:text-6xl mb-4 italic">The Crochet Sanctuary</h2>
            <p class="max-w-md mx-auto mb-8 text-sm md:text-base text-stone-600">Premium milk cotton, ergonomic hooks, and everything you need for your next crochet masterpiece.</p>
            <a href="#shop" class="inline-block bg-[#8E735B] text-white px-8 md:px-10 py-3 md:py-4 rounded-full text-xs md:text-sm uppercase tracking-widest hover:bg-[#735d4a] transition-all">Explore the Shop</a>
        </div>
    </section>

    <!-- Why Choose Us / Trust Bars -->
    <div class="bg-stone-100 py-6 border-b border-stone-200">
        <div class="container mx-auto px-4 grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
            <div class="flex flex-col items-center">
                <i class="fa-solid fa-truck-fast text-[#8E735B] mb-2"></i>
                <span class="text-[9px] font-bold uppercase tracking-wider">Same Day Shipping</span>
            </div>
            <div class="flex flex-col items-center">
                <i class="fa-solid fa-heart text-[#8E735B] mb-2"></i>
                <span class="text-[9px] font-bold uppercase tracking-wider">Hand-Picked Quality</span>
            </div>
            <div class="flex flex-col items-center">
                <i class="fa-solid fa-video text-[#8E735B] mb-2"></i>
                <span class="text-[9px] font-bold uppercase tracking-wider">Free Video Guides</span>
            </div>
            <div class="flex flex-col items-center">
                <i class="fa-solid fa-mobile-screen text-[#8E735B] mb-2"></i>
                <span class="text-[9px] font-bold uppercase tracking-wider">Secure M-Pesa Pay</span>
            </div>
        </div>
    </div>

    <!-- Category Filter -->
    <div class="container mx-auto px-4 py-12" id="shop">
        <div class="flex justify-between items-center mb-8">
            <div class="flex gap-4 overflow-x-auto scroll-hide no-scrollbar">
                <button onclick="filterProducts('all')" class="whitespace-nowrap px-6 py-2 rounded-full border border-stone-300 transition bg-stone-800 text-white" id="btn-all">All Supplies</button>
                <button onclick="filterProducts('yarn')" class="whitespace-nowrap px-6 py-2 rounded-full border border-stone-300 transition" id="btn-yarn">Yarn Bar</button>
                <button onclick="filterProducts('hooks')" class="whitespace-nowrap px-6 py-2 rounded-full border border-stone-300 transition" id="btn-hooks">Hooks</button>
                <button onclick="filterProducts('accessories')" class="whitespace-nowrap px-6 py-2 rounded-full border border-stone-300 transition" id="btn-accessories">Notions</button>
            </div>
            <div class="hidden md:block text-[10px] text-stone-400 font-bold uppercase tracking-widest">
                Showing <span id="item-range">1-8</span> of 50 items
            </div>
        </div>

        <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 md:gap-8" id="product-grid"></div>
        
        <!-- Pagination Button -->
        <div class="mt-16 text-center" id="pagination-container">
            <button onclick="loadMoreProducts()" id="load-more-btn" class="px-12 py-4 border-2 border-[#8E735B] text-[#8E735B] text-xs font-bold uppercase tracking-widest rounded-full hover:bg-[#8E735B] hover:text-white transition-all duration-300 shadow-xl shadow-stone-200">
                Discover More Stitches
            </button>
        </div>
    </div>

    <!-- Custom Commissions -->
    <section class="bg-[#E8DED1] py-12 md:py-20 mt-12" id="commissions">
        <div class="container mx-auto px-4">
            <div class="max-w-5xl mx-auto grid md:grid-cols-2 gap-8 md:gap-12 items-center bg-white p-6 md:p-12 rounded-3xl shadow-sm border border-stone-100">
                <div>
                    <h2 class="text-2xl md:text-4xl italic mb-4">Bespoke Crochet Requests</h2>
                    <p class="text-sm md:text-base text-stone-600 mb-6 leading-relaxed">Have a specific crochet pattern in mind or want a custom-made amigurumi? Our expert crocheters are ready to bring your vision to life, stitch by stitch.</p>
                    <div class="flex items-center gap-4 text-[#8E735B]">
                        <div class="w-10 h-10 md:w-12 md:h-12 rounded-full bg-stone-50 flex items-center justify-center">
                            <i class="fa-solid fa-wand-magic-sparkles text-lg"></i>
                        </div>
                        <span class="text-[10px] md:text-sm font-bold uppercase tracking-widest">Handmade with Love</span>
                    </div>
                </div>
                <form action="https://formsubmit.co/jeanyarnshaven@gmail.com" method="POST" class="space-y-4">
                    <input type="hidden" name="_subject" value="New Crochet Commission Request!">
                    <input type="hidden" name="_captcha" value="false">
                    <input type="text" name="name" placeholder="Full Name" required class="w-full bg-stone-50 border border-stone-100 p-4 rounded-2xl outline-none focus:border-[#C4A484] transition text-sm">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <input type="email" name="email" placeholder="Email" required class="w-full bg-stone-50 border border-stone-100 p-4 rounded-2xl outline-none focus:border-[#C4A484] transition text-sm">
                        <input type="tel" name="phone" placeholder="Phone/WhatsApp" required class="w-full bg-stone-50 border border-stone-100 p-4 rounded-2xl outline-none focus:border-[#C4A484] transition text-sm">
                    </div>
                    <select name="type" required class="w-full bg-stone-50 border border-stone-100 p-4 rounded-2xl outline-none focus:border-[#C4A484] transition text-sm appearance-none">
                        <option value="" disabled selected>Select Category</option>
                        <option value="apparel">Crochet Apparel</option>
                        <option value="amigurumi">Amigurumi</option>
                        <option value="home">Home Decor</option>
                    </select>
                    <textarea name="message" placeholder="Details (Size, Colors, Deadline)..." rows="4" required class="w-full bg-stone-50 border border-stone-100 p-4 rounded-2xl outline-none focus:border-[#C4A484] transition text-sm"></textarea>
                    <button type="submit" class="w-full bg-[#8E735B] text-white py-4 rounded-2xl uppercase tracking-widest text-xs font-bold shadow-lg">Send Request</button>
                </form>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-stone-50 border-t border-stone-200 mt-20 py-16 md:py-20">
        <div class="container mx-auto px-4">
            <div class="grid md:grid-cols-3 gap-12 text-center md:text-left">
                <div>
                    <h3 class="text-xl mb-6 italic">Crochet Community</h3>
                    <ul class="space-y-4 text-stone-600">
                        <li>
                            <div class="flex items-center gap-3 justify-center md:justify-start transition text-[#8E735B] mb-2">
                                <i class="fa-solid fa-location-dot text-sm"></i>
                                <span class="text-sm font-bold uppercase tracking-wider">Kiambu Town, Nairobi, Kenya</span>
                            </div>
                        </li>
                        <li>
                            <a href="https://wa.me/254783979282" target="_blank" class="hover:text-[#C4A484] flex items-center gap-3 justify-center md:justify-start transition">
                                <i class="fa-brands fa-whatsapp text-lg"></i>
                                <span class="text-sm font-medium">Chat on WhatsApp</span>
                            </a>
                        </li>
                        <li>
                            <a href="tel:+254759225892" class="hover:text-[#C4A484] flex items-center gap-3 justify-center md:justify-start transition">
                                <i class="fa-solid fa-phone-flip text-sm"></i>
                                <span class="text-sm font-medium">+254 759 225 892</span>
                            </a>
                        </li>
                        <li>
                            <a href="mailto:jeanyarnshaven@gmail.com" class="hover:text-[#C4A484] flex items-center gap-3 justify-center md:justify-start transition">
                                <i class="fa-regular fa-envelope text-sm"></i>
                                <span class="text-sm font-medium">jeanyarnshaven@gmail.com</span>
                            </a>
                        </li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-xl mb-6 italic">Support</h3>
                    <ul class="space-y-3 text-stone-500 text-sm">
                        <li><a href="#" class="hover:text-stone-800 transition">Shipping Policy</a></li>
                        <li><a href="#" class="hover:text-stone-800 transition">Pattern Returns</a></li>
                        <li><a href="#" class="hover:text-stone-800 transition">Bulk Yarn Orders</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-xl mb-6 italic">Social Stitches</h3>
                    <div class="flex gap-4 justify-center md:justify-start mb-6">
                        <a href="https://www.instagram.com/_jeansyarnhaven" target="_blank" class="w-10 h-10 rounded-full border border-stone-200 flex items-center justify-center hover:bg-[#8E735B] hover:text-white transition">
                            <i class="fa-brands fa-instagram"></i>
                        </a>
                        <a href="#" class="w-10 h-10 rounded-full border border-stone-200 flex items-center justify-center hover:bg-[#8E735B] hover:text-white transition">
                            <i class="fa-brands fa-tiktok"></i>
                        </a>
                    </div>
                </div>
            </div>
            
            <div class="mt-16 pt-8 border-t border-stone-200 flex flex-col md:flex-row justify-between items-center gap-4 text-[9px] md:text-[10px] text-stone-400 uppercase tracking-[0.3em] text-center">
                <div>&copy; 2024 Jeans Yarn Haven. Built for Crocheters.</div>
                <div>
                    Designed by 
                    <a href="https://www.exevodesigners.online" target="_blank" class="text-stone-600 hover:text-[#C4A484] transition underline decoration-stone-200">Exevo Designers</a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Cart Sidebar -->
    <div id="cart-sidebar" class="fixed inset-y-0 right-0 w-full md:w-[400px] bg-white shadow-2xl z-[300] transform translate-x-full transition-transform duration-500 ease-in-out">
        <div class="p-6 md:p-8 h-full flex flex-col">
            <div class="flex justify-between items-center mb-10">
                <h3 class="text-2xl md:text-3xl italic">Your Project Bag</h3>
                <button onclick="toggleCart()" class="text-3xl hover:text-red-400 transition">&times;</button>
            </div>
            <div id="cart-items" class="flex-grow overflow-y-auto space-y-4 pr-2">
                <p class="text-stone-300 text-center py-20 italic">Bag is empty...</p>
            </div>
            <div class="pt-8 border-t border-stone-100">
                <div class="flex justify-between items-center mb-6">
                    <span class="text-stone-500 uppercase tracking-widest text-[10px] font-bold">Total Estimate</span>
                    <span id="cart-total" class="text-xl md:text-2xl font-bold">KSh 0</span>
                </div>
                <button onclick="checkout()" class="w-full bg-[#8E735B] text-white py-4 rounded-2xl uppercase tracking-widest text-xs font-bold shadow-lg">Checkout via WhatsApp</button>
            </div>
        </div>
    </div>

    <script>
        // --- Currency Configuration ---
        // Base currency is KES (Kenyan Shilling)
        const exchangeRates = {
            KES: 1,
            USD: 0.0076, // Approx 1 USD = 131 KES
            GBP: 0.0060, // Approx 1 GBP = 166 KES
            EUR: 0.0070  // Approx 1 EUR = 142 KES
        };

        const currencySymbols = {
            KES: 'KSh',
            USD: '$',
            GBP: '£',
            EUR: '€'
        };

        let currentCurrency = 'KES';

        // --- Product Data ---
        const products = [];
        const baseProducts = [
            { name: "Premium Milk Cotton", price: 350, category: "yarn", image: "https://images.unsplash.com/photo-1584992236310-6edddc08acff", difficulty: "Easy", rating: 4.8 },
            { name: "Ergonomic Soft-Grip Hook", price: 650, category: "hooks", image: "https://images.unsplash.com/photo-1621251954202-b2866657989d", difficulty: "All Levels", rating: 4.9 },
            { name: "Acrylic Blend Yarn", price: 280, category: "yarn", image: "https://images.unsplash.com/photo-1595079676339-1534801ad6cf", difficulty: "Beginner", rating: 4.5 },
            { name: "Stitch Marker Set", price: 150, category: "accessories", image: "https://images.unsplash.com/photo-1544441893-675973e31985", difficulty: "Essential", rating: 4.7 },
            { name: "Velvet Chenille", price: 450, category: "yarn", image: "https://images.unsplash.com/photo-1606103920295-9a091573f160", difficulty: "Intermediate", rating: 4.9 },
            { name: "Bamboo Hook Set", price: 1800, category: "hooks", image: "https://images.unsplash.com/photo-1551892308-c30931295ba5", difficulty: "Pro Choice", rating: 5.0 },
            { name: "Tapestry Needles", price: 200, category: "accessories", image: "https://images.unsplash.com/photo-1605304033107-742967667ca4", difficulty: "Basic", rating: 4.6 },
            { name: "Gradient Cake Yarn", price: 950, category: "yarn", image: "https://images.unsplash.com/photo-1516743611441-dbf411a47ac5", difficulty: "Intermediate", rating: 4.8 }
        ];

        // Seed 50 items with badges
        for(let i=0; i<50; i++) {
            const base = baseProducts[i % baseProducts.length];
            products.push({
                id: i + 1,
                name: `${base.name} (Variant ${i + 1})`,
                price: base.price + (Math.floor(Math.random() * 50) * 10),
                category: base.category,
                image: `${base.image}?auto=format&fit=crop&q=80&w=400&sig=${i}`,
                difficulty: base.difficulty,
                rating: base.rating,
                isBestSeller: i % 7 === 0,
                isNew: i % 11 === 0
            });
        }

        let cart = [];
        let currentPage = 1;
        const itemsPerPage = 8;
        let currentFilter = 'all';

        // --- Core Functions ---

        function toggleMobileMenu() {
            const menu = document.getElementById('mobile-menu');
            const isVisible = menu.style.display === 'flex';
            menu.style.display = isVisible ? 'none' : 'flex';
            document.body.style.overflow = isVisible ? 'auto' : 'hidden';
        }

        // Currency Formatting
        function formatPrice(priceInKES) {
            const rate = exchangeRates[currentCurrency];
            const converted = priceInKES * rate;
            // Use local string formatting but ensure currency symbol is correct
            return `${currencySymbols[currentCurrency]} ${converted.toLocaleString(undefined, {
                minimumFractionDigits: 0,
                maximumFractionDigits: 2
            })}`;
        }

        // Currency Detection & Update
        function detectUserCurrency() {
            // 1. Check LocalStorage
            const stored = localStorage.getItem('haven_currency');
            if (stored && exchangeRates[stored]) {
                updateCurrency(stored, false);
                return;
            }

            // 2. Auto-detect via Timezone (approximate)
            try {
                const tz = Intl.DateTimeFormat().resolvedOptions().timeZone;
                let detected = 'KES'; // Default
                
                if (tz.includes('Europe/London')) detected = 'GBP';
                else if (tz.includes('Europe')) detected = 'EUR';
                else if (tz.includes('America')) detected = 'USD';
                
                // Only set if not KES (to allow default override)
                if (detected !== 'KES') {
                    updateCurrency(detected, false);
                }
            } catch (e) {
                console.log('Currency detection skipped');
            }
        }

        function updateCurrency(code, refresh = true) {
            if (!exchangeRates[code]) return;
            currentCurrency = code;
            localStorage.setItem('haven_currency', code);
            
            // Update Selectors UI
            const desktopSelect = document.getElementById('currency-desktop');
            if(desktopSelect) desktopSelect.value = code;

            // Update Mobile Buttons
            document.querySelectorAll('.currency-btn-mobile').forEach(btn => {
                if(btn.dataset.curr === code) {
                    btn.classList.add('bg-stone-800', 'text-white', 'border-stone-800');
                    btn.classList.remove('bg-white', 'text-stone-800', 'border-stone-200');
                } else {
                    btn.classList.remove('bg-stone-800', 'text-white', 'border-stone-800');
                    btn.classList.add('bg-white', 'text-stone-800', 'border-stone-200');
                }
            });

            // Update Static Elements with data-price-kes attribute
            document.querySelectorAll('[data-price-kes]').forEach(el => {
                const basePrice = parseFloat(el.getAttribute('data-price-kes'));
                el.innerText = formatPrice(basePrice);
            });

            if (refresh) {
                renderProducts();
                updateCartUI();
            }
        }

        function getFilteredProducts() {
            return currentFilter === 'all' 
                ? products 
                : products.filter(p => p.category === currentFilter);
        }

        function renderProducts(append = false) {
            const grid = document.getElementById('product-grid');
            if (!append) {
                grid.innerHTML = '';
                currentPage = 1;
            }
            
            const filtered = getFilteredProducts();
            const start = (currentPage - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const pageItems = filtered.slice(start, end);

            pageItems.forEach(p => {
                const card = document.createElement('div');
                card.className = 'group product-card animate-fade-in relative';
                card.innerHTML = `
                    <div class="relative aspect-[4/5] bg-stone-200 overflow-hidden mb-3 md:mb-4 rounded-2xl md:rounded-3xl shadow-sm">
                        <!-- Badges -->
                        <div class="absolute top-3 left-3 z-10 flex flex-col gap-1">
                            ${p.isBestSeller ? '<span class="badge-best-seller">Best Seller</span>' : ''}
                            ${p.isNew ? '<span class="bg-white text-stone-800 px-2 py-0.5 rounded text-[8px] font-bold uppercase border border-stone-200">New</span>' : ''}
                        </div>
                        
                        <img src="${p.image}" alt="${p.name}" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110">
                        
                        <!-- Quick Add Overlay -->
                        <div class="absolute inset-0 bg-black bg-opacity-10 opacity-0 group-hover:opacity-100 transition-all duration-300 flex items-end p-2 md:p-4">
                            <button onclick="addToCart(${p.id})" class="w-full bg-white text-black py-3 md:py-4 text-[10px] md:text-xs uppercase font-bold tracking-widest hover:bg-[#8E735B] hover:text-white transition rounded-xl md:rounded-2xl shadow-xl transform translate-y-2 group-hover:translate-y-0 transition-transform">Quick Stitch Bag</button>
                        </div>
                    </div>
                    
                    <div class="px-1">
                        <div class="flex justify-between items-start mb-1">
                            <h4 class="text-[11px] md:text-[13px] font-bold text-stone-800 truncate pr-2 uppercase tracking-tight">${p.name}</h4>
                            <div class="flex items-center gap-1 shrink-0">
                                <i class="fa-solid fa-star text-[10px] text-yellow-500"></i>
                                <span class="text-[10px] text-stone-500 font-bold">${p.rating}</span>
                            </div>
                        </div>
                        
                        <div class="flex items-center gap-2 mb-2">
                             <span class="text-[8px] uppercase tracking-wider text-[#8E735B] font-bold px-1.5 py-0.5 bg-stone-100 rounded">${p.difficulty}</span>
                        </div>

                        <div class="flex items-baseline gap-2">
                            <p class="text-stone-900 text-[12px] md:text-[15px] font-bold">${formatPrice(p.price)}</p>
                            <p class="text-[9px] text-stone-400 line-through">${formatPrice(p.price * 1.2)}</p>
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });

            // Update item range indicator
            document.getElementById('item-range').innerText = `1-${Math.min(end, filtered.length)}`;

            // Handle button visibility
            const btn = document.getElementById('pagination-container');
            if (end >= filtered.length) {
                btn.classList.add('hidden');
            } else {
                btn.classList.remove('hidden');
            }
        }

        function loadMoreProducts() {
            currentPage++;
            renderProducts(true);
        }

        function toggleSearch() {
            const overlay = document.getElementById('search-overlay');
            const isVisible = overlay.style.display === 'flex';
            overlay.style.display = isVisible ? 'none' : 'flex';
            if (!isVisible) document.getElementById('search-input').focus();
            document.body.style.overflow = isVisible ? 'auto' : 'hidden';
        }

        function handleSearch() {
            const query = document.getElementById('search-input').value.toLowerCase();
            const resultsContainer = document.getElementById('search-results');
            if (query.length < 1) { resultsContainer.innerHTML = ''; return; }
            const results = products.filter(p => p.name.toLowerCase().includes(query)).slice(0, 9);
            resultsContainer.innerHTML = '';
            results.forEach(p => {
                const item = document.createElement('div');
                item.className = 'flex flex-col gap-2 p-3 hover:bg-stone-50 rounded-2xl cursor-pointer animate-fade-in';
                item.onclick = () => { toggleSearch(); document.getElementById('shop').scrollIntoView({ behavior: 'smooth' }); };
                item.innerHTML = `
                    <img src="${p.image}" class="aspect-square rounded-xl object-cover">
                    <p class="text-[10px] font-bold text-stone-800 truncate">${p.name}</p>
                `;
                resultsContainer.appendChild(item);
            });
        }

        function filterProducts(cat) {
            currentFilter = cat;
            ['all', 'yarn', 'hooks', 'accessories'].forEach(b => {
                const el = document.getElementById('btn-' + b);
                el.classList.toggle('bg-stone-800', b === cat);
                el.classList.toggle('text-white', b === cat);
            });
            renderProducts(false);
        }

        function toggleCart() { document.getElementById('cart-sidebar').classList.toggle('translate-x-full'); }

        function addToCart(id) {
            const product = products.find(p => p.id === id);
            cart.push(product);
            updateCartUI();
            
            // Interaction feedback
            const btn = event.target;
            const originalText = btn.innerText;
            btn.innerText = "✓ Stitch Added";
            btn.style.backgroundColor = "#22c55e"; // Success green
            setTimeout(() => { 
                btn.innerText = originalText; 
                btn.style.backgroundColor = "";
            }, 1200);
        }

        function updateCartUI() {
            const cartItems = document.getElementById('cart-items');
            document.getElementById('cart-count').innerText = cart.length;
            if (cart.length === 0) {
                cartItems.innerHTML = '<p class="text-stone-300 text-center py-20 italic">Bag is empty...</p>';
                document.getElementById('cart-total').innerText = formatPrice(0);
                return;
            }
            cartItems.innerHTML = '';
            let total = 0;
            cart.forEach((item, index) => {
                total += item.price;
                const div = document.createElement('div');
                div.className = 'flex gap-4 items-center bg-stone-50 p-3 rounded-2xl animate-fade-in';
                div.innerHTML = `
                    <img src="${item.image}" class="w-16 h-16 object-cover rounded-xl">
                    <div class="flex-grow">
                        <h5 class="text-[11px] font-bold uppercase">${item.name}</h5>
                        <p class="text-[10px] text-[#8E735B]">${formatPrice(item.price)}</p>
                    </div>
                    <button onclick="removeFromCart(${index})" class="text-stone-300 hover:text-red-400">&times;</button>
                `;
                cartItems.appendChild(div);
            });
            document.getElementById('cart-total').innerText = formatPrice(total);
        }

        function removeFromCart(index) { cart.splice(index, 1); updateCartUI(); }

        function checkout() {
            if (cart.length === 0) return;
            let message = `Hello Jeans Yarn Haven! I'd like to order (Currency: ${currentCurrency}):\n\n`;
            cart.forEach((item, i) => { 
                message += `${i+1}. ${item.name} - ${formatPrice(item.price)}\n`; 
            });
            const total = cart.reduce((sum, item) => sum + item.price, 0);
            message += `\nTotal: ${formatPrice(total)}`;
            window.open(`https://wa.me/254783979282?text=${encodeURIComponent(message)}`, '_blank');
        }

        window.onload = () => { 
            detectUserCurrency();
            renderProducts(); 
        }
    </script>
</body>
</html>
